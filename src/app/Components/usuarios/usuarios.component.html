
<h1 class="text-center">Listado de personas</h1><br>

<button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#addUser" aria-controls="offcanvasExample" (click)="btnAddUser()">
  <i class="bi bi-person-plus"></i> Añadir Usuario
</button>

<div class="offcanvas offcanvas-start" tabindex="-1" id="addUser" aria-labelledby="offcanvasExampleLabel">
  <div class="offcanvas-header bg-success-subtle">
    <h5 class="offcanvas-title" id="offcanvasExampleLabel">Añadir Usuario</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <div class="formulario">
        <form [formGroup]="form" class="row" (ngSubmit)="postUsers()">
            <div class="col-12">
                <label for="nombre" class="form-label">Nombre</label>
                <input type="text" class="form-control" id="nombre" formControlName="nombre" name="nombre">
            </div>
            <!--Validación usuario-->
            @if (form.controls['nombre'].invalid && (form.controls['nombre'].dirty || form.controls['nombre'].touched)) {
               @if(form.controls['nombre'].errors?.['required']){
                 <span class="text-danger">Campo requerido</span>
                }
            
                @if(form.controls['nombre'].errors?.['maxLength']){
                   <span class="text-danger">Excede el límite</span>
                }

                @if(form.controls['nombre'].errors?.['pattern']){
                   <span class="text-danger">Ingrese solo letras</span>
                }
            }

            <div class="col-12">
                <label for="apellido" class="form-label">Apellido</label>
                <input type="text" class="form-control" id="apellido" formControlName="apellido" name="apellido">
            </div>

            <!--Validación apellido-->
            @if (form.controls['apellido'].invalid && (form.controls['apellido'].dirty || form.controls['apellido'].touched)) {
               @if(form.controls['apellido'].errors?.['required']){
                 <span class="text-danger">Campo requerido</span>
                }
            
                @if(form.controls['apellido'].errors?.['maxLength']){
                   <span class="text-danger">Excede el límite</span>
                }

                @if(form.controls['apellido'].errors?.['pattern']){
                   <span class="text-danger">Ingrese solo letras</span>
                }
            }
            <div class="col-5">
                <label for="edad" class="form-label">Edad</label>
                <input type="text" class="form-control" id="edad" formControlName="edad" name="edad">
            </div>

            <!--Validación apellido-->
            @if (form.controls['apellido'].invalid && (form.controls['apellido'].dirty || form.controls['apellido'].touched)) {
               @if(form.controls['apellido'].errors?.['required']){
                 <span class="text-danger">Campo requerido</span>
                }
            
                @if(form.controls['apellido'].errors?.['maxLength']){
                   <span class="text-danger">Excede el límite</span>
                }

                @if(form.controls['apellido'].errors?.['pattern']){
                   <span class="text-danger">Ingrese solo letras</span>
                }
            }
            
            <div class="col-12">
                <label for="prov">Seleccione un rol</label>
                <select class="form-select" id="rol" formControlName="rol" name="rol">
                    <option selected>Seleccione una opción</option>
                    <option value="Administrador">Administrador</option>
                    <option value="Usuario">Usuario</option>
                  </select>
            </div>

            <!--Validación rol-->
            @if (form.controls['rol'].invalid && (form.controls['rol'].dirty || form.controls['rol'].touched)) {
               @if(form.controls['rol'].errors?.['required']){
                 <span class="text-danger">Campo requerido</span>
                }
            
                @if(form.controls['rol'].errors?.['maxLength']){
                   <span class="text-danger">Excede el límite</span>
                }

                @if(form.controls['rol'].errors?.['pattern']){
                   <span class="text-danger">Formato incorrecto</span>
                }
            }
            <div class="col-12 d-flex justify-content-center mt-3">
               <button class="btn btn-primary" type="submit" [disabled]="this.form.invalid" data-bs-dismiss="offcanvas">Guardar</button>
            </div>
        </form>
    </div>
  </div>
</div>

<div class="offcanvas offcanvas-start" tabindex="-1" id="modUser" aria-labelledby="offcanvasExampleLabel">
  <div class="offcanvas-header bg-success-subtle">
    <h5 class="offcanvas-title" id="offcanvasExampleLabel">Añadir Usuario</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <div class="formulario">
        <form [formGroup]="form" class="row" (ngSubmit)="putUsers()">
            <div class="col-12">
                <label for="nombre" class="form-label">Nombre</label>
                <input type="text" class="form-control" id="nombre" formControlName="nombre" name="nombre">
            </div>
            <!--Validación usuario-->
            @if (form.controls['nombre'].invalid && (form.controls['nombre'].dirty || form.controls['nombre'].touched)) {
               @if(form.controls['nombre'].errors?.['required']){
                 <span class="text-danger">Campo requerido</span>
                }
            
                @if(form.controls['nombre'].errors?.['maxLength']){
                   <span class="text-danger">Excede el límite</span>
                }

                @if(form.controls['nombre'].errors?.['pattern']){
                   <span class="text-danger">Ingrese solo letras</span>
                }
            }

            <div class="col-12">
                <label for="apellido" class="form-label">Apellido</label>
                <input type="text" class="form-control" id="apellido" formControlName="apellido" name="apellido">
            </div>

            <!--Validación apellido-->
            @if (form.controls['apellido'].invalid && (form.controls['apellido'].dirty || form.controls['apellido'].touched)) {
               @if(form.controls['apellido'].errors?.['required']){
                 <span class="text-danger">Campo requerido</span>
                }
            
                @if(form.controls['apellido'].errors?.['maxLength']){
                   <span class="text-danger">Excede el límite</span>
                }

                @if(form.controls['apellido'].errors?.['pattern']){
                   <span class="text-danger">Ingrese solo letras</span>
                }
            }
            <div class="col-5">
                <label for="edad" class="form-label">Edad</label>
                <input type="text" class="form-control" id="edad" formControlName="edad" name="edad">
            </div>

            <!--Validación apellido-->
            @if (form.controls['apellido'].invalid && (form.controls['apellido'].dirty || form.controls['apellido'].touched)) {
               @if(form.controls['apellido'].errors?.['required']){
                 <span class="text-danger">Campo requerido</span>
                }
            
                @if(form.controls['apellido'].errors?.['maxLength']){
                   <span class="text-danger">Excede el límite</span>
                }

                @if(form.controls['apellido'].errors?.['pattern']){
                   <span class="text-danger">Ingrese solo letras</span>
                }
            }
            
            <div class="col-12">
                <label for="prov">Seleccione un rol</label>
                <select class="form-select" id="rol" formControlName="rol" name="rol">
                    <option selected>Seleccione una opción</option>
                    <option value="Administrador">Administrador</option>
                    <option value="Usuario">Usuario</option>
                  </select>
            </div>

            <!--Validación rol-->
            @if (form.controls['rol'].invalid && (form.controls['rol'].dirty || form.controls['rol'].touched)) {
               @if(form.controls['rol'].errors?.['required']){
                 <span class="text-danger">Campo requerido</span>
                }
            
                @if(form.controls['rol'].errors?.['maxLength']){
                   <span class="text-danger">Excede el límite</span>
                }

                @if(form.controls['rol'].errors?.['pattern']){
                   <span class="text-danger">Formato incorrecto</span>
                }
            }
            <div class="col-12 d-flex justify-content-center mt-3">
               <button class="btn btn-primary" type="submit" [disabled]="this.form.invalid" data-bs-dismiss="offcanvas">Guardar</button>
            </div>
        </form>
    </div>
  </div>
</div>

<div class="container-fluid table-responsive text-center mt-3">
    <table class="table table-bordered">
        <thead>
            <tr>
                <th class="bg-secondary-subtle" scope="col">Nombre</th>
                <th class="bg-secondary-subtle" scope="col">Apellido</th>
                <th class="bg-secondary-subtle" scope="col">Edad</th>
                <th class="bg-secondary-subtle" scope="col">Rol</th>
                <th class="bg-secondary-subtle" scope="col">Modificar</th>
                <th class="bg-secondary-subtle" scope="col">Eliminar</th>
            </tr>
        </thead>
        <tbody>
            @for (item of users; track $index) {
            <tr>
                <td>{{item.nombre}}</td>
                <td>{{item.apellido}}</td>
                <td>{{item.edad}}</td>
                <td>{{item.rol}}</td>
                <td>
                    <button class="btn btn-warning" type="button" data-bs-toggle="offcanvas" data-bs-target="#modUser" (click)="modUsuario(item.id, item)">
                        <i class="bi bi-pencil-square"></i> Modificar
                    </button>
                </td>
                <td>
                    <button class="btn btn-danger" type="button" (click)="deleteUsuario(item.id)">
                        <i class="bi bi-trash3"></i> Eliminar
                    </button>
                </td>
            </tr>
            }
        </tbody>
    </table>
</div><br>



<div class="w-25 mx-auto text-center">
    <button class="btn btn-primary" type="button" (click)="logOut()">Salir</button>
</div>